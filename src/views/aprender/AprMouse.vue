<template>
    <div>
        <h1 style="margin-top:-10vh;">Agilidade com o Mouse</h1>

        <svg class="fundo" style="top:0vh; right: 2vw" width="544" height="1080" viewBox="0 0 544 1080" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <g style="mix-blend-mode:soft-light" opacity="0.5" filter="url(#filter0_d_329_3)">
                <path d="M78.0002 -96.5C4.33351 96 -51.0998 481 316.5 481C684.1 481 469.667 950.667 316.5 1185.5"
                    stroke="white" stroke-width="40" />
            </g>
            <defs>
                <filter id="filter0_d_329_3" x="0.124512" y="-103.648" width="543.345" height="1308.07"
                    filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix" />
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                        result="hardAlpha" />
                    <feOffset dy="4" />
                    <feGaussianBlur stdDeviation="2" />
                    <feComposite in2="hardAlpha" operator="out" />
                    <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_329_3" />
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_329_3" result="shape" />
                </filter>
            </defs>
        </svg>

        <svg class="fundo" style="top:-3vh; left:-3vw" width="551" height="545" viewBox="0 0 551 545" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <g style="mix-blend-mode:soft-light" opacity="0.5" filter="url(#filter0_d_54_316)">
                <path d="M-63.5 516.5C133.333 506.833 527 377.8 527 -61" stroke="white" stroke-width="40" />
            </g>
            <defs>
                <filter id="filter0_d_54_316" x="-68.481" y="-61" width="619.481" height="605.476"
                    filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix" />
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                        result="hardAlpha" />
                    <feOffset dy="4" />
                    <feGaussianBlur stdDeviation="2" />
                    <feComposite in2="hardAlpha" operator="out" />
                    <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_54_316" />
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_54_316" result="shape" />
                </filter>
            </defs>
        </svg>

        <svg class="fundo" style="top:-3vh;right:-3vw" width="726" height="168" viewBox="0 0 726 168" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M936.971 -29.4999C772.971 118.667 356.071 326.1 0.47072 -29.5" stroke="white" />
        </svg>

        <svg class="fundo" style="top:-3vh;left:-3vw" width="695" height="266" viewBox="0 0 695 266" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M-92 256.414C170 288.019 694 249.583 694 -157" stroke="white" />
        </svg>

        <svg class="fundo" style="bottom:-3vh;right:0vw" width="1028" height="281" viewBox="0 0 1028 281" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M1 344C102.833 229.5 465.2 0.5 1100 0.5" stroke="white" />
        </svg>

        <svg class="fundo" style="bottom:-3vh;left:5vw" width="973" height="183" viewBox="0 0 973 183" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <g style="mix-blend-mode:soft-light" opacity="0.5" filter="url(#filter0_d_329_4)">
                <path d="M17.5 217C181.5 68.8334 598.4 -138.6 954 217" stroke="white" stroke-width="40" />
            </g>
            <defs>
                <filter id="filter0_d_329_4" x="0.0922852" y="0.65918" width="972.05" height="239.181"
                    filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix" />
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                        result="hardAlpha" />
                    <feOffset dy="4" />
                    <feGaussianBlur stdDeviation="2" />
                    <feComposite in2="hardAlpha" operator="out" />
                    <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_329_4" />
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_329_4" result="shape" />
                </filter>
            </defs>
        </svg>

        <section class="menu">
            <div>
                <img id="tri" src="../../assets/aprender/tri.png" height="2" width="2" style="display: none;">
                <img id="circ" src="../../assets/aprender/circ.png" height="2" width="2" style="display: none;">
                <img id="quad" src="../../assets/aprender/quad.png" height="2" width="2" style="display: none;">
                <img id="pent" src="../../assets/aprender/pent.png" height="2" width="2" style="display: none;">
                <img id="estr" src="../../assets/aprender/estr.png" height="2" width="2" style="display: none;">

                <canvas id="trencherCanvas" height="600" width="800"></canvas>
                <button title="Tentar Novamente">
                    <div class="material-symbols-outlined" style="font-size: 2em; font-weight: bold;">
                        refresh
                    </div>
                </button>
            </div>
        </section>

        <link rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,1,0" />
        <router-link to="/aprender" class="quit" style="color: black;">
            <div class="material-symbols-outlined" style="font-size: 2em; font-weight: bold;">
                keyboard_double_arrow_left
            </div>
        </router-link>
    </div>

</template>

<script>
export default {
    name: 'Apr_Mouse',
    mounted() {
        var canvas = document.getElementById('trencherCanvas');
        var canvasContext = canvas.getContext('2d');

        var life = 10;
        var tempo = 0;

        var scalew = 100;
        var scaleh = 100;

        var pause = false;

        var mousePos;

        var imgs = [document.getElementById("tri"), document.getElementById("circ"), document.getElementById("quad"), document.getElementById("pent"), document.getElementById("estr")]

        var formas = [{
            x: canvas.width / 2,
            y: canvas.height / 2,
            id: imgs[Math.floor(Math.random() * 5)],
            w: scalew,
            h: scaleh
        }];

        var drawing = {
            rectWithColor: function (rectX, rectY, rectW, rectH, rectColor) {
                canvasContext.fillStyle = rectColor;
                canvasContext.fillRect(rectX, rectY, rectW, rectH);
            },
            strokeWithColor: function (x1, y1, x2, y2, color) { //or (x1,y1,x2,y2,width,color)
                canvasContext.strokeStyle = color;
                //canvasContext.lineWidth = width;
                canvasContext.moveTo(x1, y1);
                canvasContext.lineTo(x2, y2);
                canvasContext.stroke();
            },
            circleWithColor: function (centerX, centerY, radius, color) {
                canvasContext.fillStyle = color;
                canvasContext.beginPath();
                canvasContext.arc(centerX, centerY, radius, 0, Math.PI * 2, true);
                canvasContext.fill();
            },
            text: function (font, msg, x, y, color) {
                canvasContext.fillStyle = color;
                canvasContext.font = font;
                canvasContext.fillText(msg, x, y);
            }

        };

        function calculateMousePosition(evt) {
            var rect = canvas.getBoundingClientRect();
            var root = document.documentElement;

            var mouseX = evt.clientX - rect.left - root.scrollLeft;
            var mouseY = evt.clientY - rect.top - root.scrollTop;

            return {
                x: mouseX,
                y: mouseY
            };
        }

        window.onload = function () {
            var fps = 60;
            setInterval(function () {
                if (!pause) {
                    tempo += 1 / 60;
                }
                draw();
                if (life == 0) {
                    pause = true;
                }
            }, 1000 / fps);

            canvas.addEventListener('mousemove',
                function (evt) {
                    mousePos = calculateMousePosition(evt);
                });
            canvas.addEventListener('click',
                function () {
                    if (!pause) {
                        if (mousePos.x > formas[0].x && mousePos.x < formas[0].x + formas[0].w && mousePos.y > formas[0].y && mousePos.y < formas[0].y + formas[0].h) {
                            life--;
                            formas.pop();
                            spawnImage();
                        }
                    } else {
                        if (mousePos.x > canvas.width / 2 - 100 && mousePos.x < canvas.width / 2 + 100 && mousePos.y > canvas.height / 2 - 25 && mousePos.y < canvas.height / 2 + 25) {
                            reset();
                        }
                    }
                });
        };

        function reset() {
            life = 10
            tempo = 0
            pause = false
        }

        function spawnImage() {
            var forma = {
                w: scalew,
                h: scaleh,
                x: Math.floor(Math.random() * (canvas.width - scaleh - 1)),
                y: Math.floor(Math.random() * (canvas.height - scaleh - 1)),
                id: imgs[Math.floor(Math.random() * 5)]
            };
            formas.push(forma);
        }

        function convertSecond(sec) {
            var minutes = Math.floor(sec / 60);
            var seconds = sec - minutes * 60;
            var milli = Math.floor((seconds - Math.floor(seconds)) * 100);

            if (Number(minutes) < 10) {
                minutes = "0" + minutes;
            }
            if (Number(Math.floor(seconds)) < 10) {
                seconds = "0" + Math.floor(seconds);
            } else {
                seconds = Math.floor(seconds);
            }
            if (Number(milli) < 10) {
                milli = "0" + milli;
            }
            return {
                s: seconds,
                m: minutes,
                ms: milli
            }

        }

        function draw() {
            canvasContext.clearRect(0, 0, canvas.width, canvas.height);
            if (!pause) {
                canvasContext.drawImage(formas[0].id, formas[0].x, formas[0].y, formas[0].w, formas[0].h);
            } else {
                drawing.rectWithColor(canvas.width / 2, canvas.height / 2 - 25, 200, 50, "red");
                drawing.text("20px Arial", "Tente Novamente", canvas.width / 2 + 25, canvas.height / 2, "black");
                drawing.text("30px Arial", convertSecond(tempo).m + ":" + convertSecond(tempo).s + ":" + convertSecond(tempo).ms + "", 100, 100, "blue");
            }
        }

    },
    methods: {},
    created() {
        document.getElementById("geral").href = "../geral.css";
        document.getElementById("meucss").href = "../bckg/aprender.css";
    }
}

</script>

<style scoped lang="scss">
.menu {
    background-color: #002a9680;
    border-radius: 20px;
    min-width: 70vw;
    min-height: 80vh;
    display: block;
    margin-top: -1vh;
}

canvas {
    margin: 0 auto;
}
</style>