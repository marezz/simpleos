<template>
    <div>
        <h1 style="margin-top:-10vh;">Digitar Confiante</h1>

        <svg class="fundo" style="top:0vh; right: 2vw" width="544" height="1080" viewBox="0 0 544 1080" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <g style="mix-blend-mode:soft-light" opacity="0.5" filter="url(#filter0_d_329_3)">
                <path d="M78.0002 -96.5C4.33351 96 -51.0998 481 316.5 481C684.1 481 469.667 950.667 316.5 1185.5"
                    stroke="white" stroke-width="40" />
            </g>
            <defs>
                <filter id="filter0_d_329_3" x="0.124512" y="-103.648" width="543.345" height="1308.07"
                    filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix" />
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                        result="hardAlpha" />
                    <feOffset dy="4" />
                    <feGaussianBlur stdDeviation="2" />
                    <feComposite in2="hardAlpha" operator="out" />
                    <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_329_3" />
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_329_3" result="shape" />
                </filter>
            </defs>
        </svg>

        <svg class="fundo" style="top:-3vh; left:-3vw" width="551" height="545" viewBox="0 0 551 545" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <g style="mix-blend-mode:soft-light" opacity="0.5" filter="url(#filter0_d_54_316)">
                <path d="M-63.5 516.5C133.333 506.833 527 377.8 527 -61" stroke="white" stroke-width="40" />
            </g>
            <defs>
                <filter id="filter0_d_54_316" x="-68.481" y="-61" width="619.481" height="605.476"
                    filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix" />
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                        result="hardAlpha" />
                    <feOffset dy="4" />
                    <feGaussianBlur stdDeviation="2" />
                    <feComposite in2="hardAlpha" operator="out" />
                    <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_54_316" />
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_54_316" result="shape" />
                </filter>
            </defs>
        </svg>

        <svg class="fundo" style="top:-3vh;right:-3vw" width="726" height="168" viewBox="0 0 726 168" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M936.971 -29.4999C772.971 118.667 356.071 326.1 0.47072 -29.5" stroke="white" />
        </svg>

        <svg class="fundo" style="top:-3vh;left:-3vw" width="695" height="266" viewBox="0 0 695 266" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M-92 256.414C170 288.019 694 249.583 694 -157" stroke="white" />
        </svg>

        <svg class="fundo" style="bottom:-3vh;right:0vw" width="1028" height="281" viewBox="0 0 1028 281" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M1 344C102.833 229.5 465.2 0.5 1100 0.5" stroke="white" />
        </svg>

        <svg class="fundo" style="bottom:-3vh;left:5vw" width="973" height="183" viewBox="0 0 973 183" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <g style="mix-blend-mode:soft-light" opacity="0.5" filter="url(#filter0_d_329_4)">
                <path d="M17.5 217C181.5 68.8334 598.4 -138.6 954 217" stroke="white" stroke-width="40" />
            </g>
            <defs>
                <filter id="filter0_d_329_4" x="0.0922852" y="0.65918" width="972.05" height="239.181"
                    filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix" />
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                        result="hardAlpha" />
                    <feOffset dy="4" />
                    <feGaussianBlur stdDeviation="2" />
                    <feComposite in2="hardAlpha" operator="out" />
                    <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_329_4" />
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_329_4" result="shape" />
                </filter>
            </defs>
        </svg>

        <dialog>
            <h2>Tutorial - Explicando as teclas</h2>
            <img style="width: 55vw; min-width: 330px;" src="@/assets/aprender/tutorial.png">
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,700,0,0" />
            <div class="material-symbols-outlined" style="margin: 10px; font-size: 2em; font-weight: bold;">
                keyboard_double_arrow_right
            </div>
        </dialog>

        <section class="menu">
            <div style="font-size: 2.5em;">
                <img id="ctrl" src="@/assets/aprender/ctrl.png" style="display: none;">
                <img id="fixa" src="@/assets/aprender/fixa.png" style="display: none;">
                <img id="shift" src="@/assets/aprender/shift.png" style="display: none;">
                <img id="tec" src="@/assets/aprender/tec.png" style="display: none;">
                <img id="tec_+" src="@/assets/aprender/tec_+.png" style="display: none;">
                <img id="tec_-" src="@/assets/aprender/tec_-.png" style="display: none;">
                <img id="tec_0" src="@/assets/aprender/tec_0.png" style="display: none;">
                <img id="tec_1" src="@/assets/aprender/tec_1.png" style="display: none;">
                <img id="tec_2" src="@/assets/aprender/tec_2.png" style="display: none;">
                <img id="tec_3" src="@/assets/aprender/tec_3.png" style="display: none;">
                <img id="tec_4" src="@/assets/aprender/tec_4.png" style="display: none;">
                <img id="tec_5" src="@/assets/aprender/tec_5.png" style="display: none;">
                <img id="tec_6" src="@/assets/aprender/tec_6.png" style="display: none;">
                <img id="tec_7" src="@/assets/aprender/tec_7.png" style="display: none;">
                <img id="tec_8" src="@/assets/aprender/tec_8.png" style="display: none;">
                <img id="tec_9" src="@/assets/aprender/tec_9.png" style="display: none;">
                <img id="tec_a" src="@/assets/aprender/tec_a.png" style="display: none;">
                <img id="tec_alt" src="@/assets/aprender/tec_alt.png" style="display: none;">
                <img id="tec_b" src="@/assets/aprender/tec_b.png" style="display: none;">
                <img id="tec_back" src="@/assets/aprender/tec_back.png" style="display: none;">
                <img id="tec_c" src="@/assets/aprender/tec_c.png" style="display: none;">
                <img id="tec_cedilha" src="@/assets/aprender/tec_cedilha.png" style="display: none;">
                <img id="tec_ctrl" src="@/assets/aprender/tec_ctrl.png" style="display: none;">
                <img id="tec_d" src="@/assets/aprender/tec_d.png" style="display: none;">
                <img id="tec_doispontos" src="@/assets/aprender/tec_doispontos.png" style="display: none;">
                <img id="tec_e" src="@/assets/aprender/tec_e.png" style="display: none;">
                <img id="tec_enter" src="@/assets/aprender/tec_enter.png" style="display: none;">
                <img id="tec_f" src="@/assets/aprender/tec_f.png" style="display: none;">
                <img id="tec_g" src="@/assets/aprender/tec_g.png" style="display: none;">
                <img id="tec_h" src="@/assets/aprender/tec_h.png" style="display: none;">
                <img id="tec_i" src="@/assets/aprender/tec_i.png" style="display: none;">
                <img id="tec_interrog" src="@/assets/aprender/tec_interrog.png" style="display: none;">
                <img id="tec_j" src="@/assets/aprender/tec_j.png" style="display: none;">
                <img id="tec_k" src="@/assets/aprender/tec_k.png" style="display: none;">
                <img id="tec_l" src="@/assets/aprender/tec_l.png" style="display: none;">
                <img id="tec_m" src="@/assets/aprender/tec_m.png" style="display: none;">
                <img id="tec_menu" src="@/assets/aprender/tec_menu.png" style="display: none;">
                <img id="tec_n" src="@/assets/aprender/tec_n.png" style="display: none;">
                <img id="tec_o" src="@/assets/aprender/tec_o.png" style="display: none;">
                <img id="tec_p" src="@/assets/aprender/tec_p.png" style="display: none;">
                <img id="tec_pipe" src="@/assets/aprender/tec_pipe.png" style="display: none;">
                <img id="tec_ponto" src="@/assets/aprender/tec_ponto.png" style="display: none;">
                <img id="tec_q" src="@/assets/aprender/tec_q.png" style="display: none;">
                <img id="tec_r" src="@/assets/aprender/tec_r.png" style="display: none;">
                <img id="tec_rightbrack" src="@/assets/aprender/tec_rightbrack.png" style="display: none;">
                <img id="tec_s" src="@/assets/aprender/tec_s.png" style="display: none;">
                <img id="tec_shift" src="@/assets/aprender/tec_shift.png" style="display: none;">
                <img id="tec_space" src="@/assets/aprender/tec_space.png" style="display: none;">
                <img id="tec_t" src="@/assets/aprender/tec_t.png" style="display: none;">
                <img id="tec_tab" src="@/assets/aprender/tec_tab.png" style="display: none;">
                <img id="tec_til" src="@/assets/aprender/tec_til.png" style="display: none;">
                <img id="tec_u" src="@/assets/aprender/tec_u.png" style="display: none;">
                <img id="tec_v" src="@/assets/aprender/tec_v.png" style="display: none;">
                <img id="tec_virg" src="@/assets/aprender/tec_virg.png" style="display: none;">
                <img id="tec_w" src="@/assets/aprender/tec_w.png" style="display: none;">
                <img id="tec_win" src="@/assets/aprender/tec_win.png" style="display: none;">
                <img id="tec_x" src="@/assets/aprender/tec_x.png" style="display: none;">
                <img id="tec_y" src="@/assets/aprender/tec_y.png" style="display: none;">
                <img id="tec_z" src="@/assets/aprender/tec_z.png" style="display: none;">
                <img id="tec_[" src="@/assets/aprender/tec_[.png" style="display: none;">
                <img id="tec__" src="@/assets/aprender/tec__.png" style="display: none;">
                <img id="til_png" src="@/assets/aprender/til_png.png" style="display: none;">

                <canvas style="display:none; padding-top: 6%; padding-left: 4%;" id="trencherCanvas" height="400"
                    width="1200"></canvas>

                <p style="display: none;" id="frase1"></p>
                <p id="frase2" style="display: none; z-index: 9;color: yellow;"></p>
            </div>
        </section>

        <link rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,700,0,0" />
        <router-link to="/home" class="quit" style="color: black;">
            <div class="material-symbols-outlined" style="font-size: 2em;">
                keyboard_double_arrow_left
            </div>
        </router-link>
    </div>

</template>

<script>

export default {
    name: 'Apr_Teclado',
    data() {
        return {
        }
    },
    mounted() {
        //Modal
        var modal = document.querySelector("dialog")
        modal.showModal()

        document.querySelector("dialog div").onclick = function () {  
            sessionStorage.setItem("reloading", "true");
            location.reload()
        }

        function start(){
            modal.close()
            document.getElementById("trencherCanvas").style.display = "block"
            document.getElementById("frase1").style.display = "block"
            document.getElementById("frase2").style.display = "block"
        }

        //Canvas
        var canvas = document.getElementById('trencherCanvas');
        var canvasContext = canvas.getContext('2d');

        var teclado = {
            x: 0,
            y: 0,
            h: 349.772,
            w: 1052.532,
            img: document.getElementById("tec"),
            counter: 0,
        }

        var especial = {
            img: document.getElementById("shift"),
            x: 2,
            y: 211.47,
            w: 1052.532,
            h: 67.814,
            check: false,
            capsOn: false
        }

        var pals = ["Bem-vindo ao SimpleOS! Para começar o jogo, digite as teclas amarelas.","O rapaz foi ao mercado comprar frutas.","A menina gosta de ler?","O carro estacionou na rua.","O gato comeu o peixe-palhaço?","A mulher preparou um jantar luxuoso.","A noite cai cedo no inverno?","Eu gosto de comida brasileira.","Eu quero ir ao Rio de Janeiro!","Eu quero aprender mais sobre a cultura brasileira.","Vou ao mercado comprar frutas e legumes.","A professora ensina a ler e escrever.","O homem caminha em qual rua?","A menina brinca com a boneca."];

        var palavras = [{
            _self: pals[0]
        }];

        var palavra_copia = ''

        var letra;

        /*var drawing = {
            rectWithColor: function (rectX, rectY, rectW, rectH, rectColor) {
                canvasContext.fillStyle = rectColor;
                canvasContext.fillRect(rectX, rectY, rectW, rectH);
            },
            strokeWithColor: function (x1, y1, x2, y2, color) { //or (x1,y1,x2,y2,width,color)
                canvasContext.strokeStyle = color;
                //canvasContext.lineWidth = width;
                canvasContext.moveTo(x1, y1);
                canvasContext.lineTo(x2, y2);
                canvasContext.stroke();
            },
            circleWithColor: function (centerX, centerY, radius, color) {
                canvasContext.fillStyle = color;
                canvasContext.beginPath();
                canvasContext.arc(centerX, centerY, radius, 0, Math.PI * 2, true);
                canvasContext.fill();
            },
            text: function (font, msg, x, y, color) {
                canvasContext.fillStyle = color;
                canvasContext.font = font;
                canvasContext.fillText(msg, x, y);
            }
        };*/

        window.onload = function () {
            var reloading = sessionStorage.getItem("reloading");
            if (reloading) {
                sessionStorage.removeItem("reloading");
                start();
            }
            var fps = 60;
            setInterval(function () {
                draw();
                especialControll();
            }, 1000 / fps);

            document.addEventListener('keyup', function (event) {
                especial.capsOn = event.getModifierState('CapsLock');
                letra = palavras[0]._self.charAt(teclado.counter);
                if (letra != letra.toUpperCase() && event.key == letra) {
                    palavra_copia += letra;
                    teclado.counter++;
                }
                else if (letra == letra.toUpperCase()) {
                    if (event.key == letra) {
                        palavra_copia += letra;
                        teclado.counter++;
                        especial.check = false;
                    }
                }
                if (teclado.counter == palavras[0]._self.length) {
                    teclado.counter = 0;
                    palavra_copia = ''
                    palavras.pop();
                    insertNewWord();
                }
            });
        }

        /*function findWord(n){
            var word = palavras[0]._self.split(" ")
            var sumn = 0
            for(var i=0;i<word.length;i++){
                for(var j=0;i<word[i].length;j++){
                    console.log(word[i].charAt(j))
                    sumn++
                    console.log(sumn)
                    if(sumn == n+1){
                        return word[i]
                    }
                }
                sumn++
            }
        }*/

        function especialControll() {
            if (palavras[0]._self.charAt(teclado.counter) == palavras[0]._self.charAt(teclado.counter).toUpperCase() && palavras[0]._self.charAt(teclado.counter) != " " && palavras[0]._self.charAt(teclado.counter) != "," && palavras[0]._self.charAt(teclado.counter) != ".") {
                especial.check = true;
                if (palavras[0]._self.toUpperCase() == palavras[0]._self) {
                    especial.w = 112.428;
                    especial.h = 67.814;
                    especial.y = 140.98;
                    especial.img = document.getElementById("fixa")
                    if (especial.capsOn) {
                        especial.check = false;
                    }
                } else {
                    especial.y = 211.47;
                    especial.w = 1052.532;
                    especial.h = 67.814;
                    especial.img = document.getElementById("shift")
                }
            }
            if (especial.capsOn && palavras[0]._self.charAt(teclado.counter) == palavras[0]._self.charAt(teclado.counter).toLowerCase()) {
                especial.check = true;
                especial.w = 112.428;
                especial.h = 67.814;
                especial.y = 140.98;
                especial.img = document.getElementById("fixa")
            }
            if(!especial.capsOn && palavras[0]._self.charAt(teclado.counter) == palavras[0]._self.charAt(teclado.counter).toLowerCase() && palavras[0]._self.charAt(teclado.counter) != "?" && palavras[0]._self.charAt(teclado.counter) != "!"){
                especial.check = false;
            }
        }

        function insertNewWord() {
            var palavra = {
                _self: pals[Math.floor(Math.random() * pals.length)],
            };
            if(pals.includes("Bem-vindo ao SimpleOS! Para começar o jogo, digite as teclas amarelas.")){
                pals.shift()
            }
            palavras.push(palavra);
        }

        function draw() {
            letra = palavras[0]._self.charAt(teclado.counter);
            //drawing.rectWithColor(0, 0, canvas.width, canvas.height, "black");
            canvasContext.clearRect(0, 0, canvas.width, canvas.height);
            if (letra == " ") {
                teclado.img = document.getElementById("tec_space")
            } else if (letra == ".") {
                teclado.img = document.getElementById("tec_ponto")
            } else if (letra == ",") {
                teclado.img = document.getElementById("tec_virg")
            } else if (letra == ":") {
                teclado.img = document.getElementById("tec_doispontos")
            } else if (letra == "?") {
                teclado.img = document.getElementById("tec_interrog")
            } else if (letra == "!") {
                teclado.img = document.getElementById("tec_1")
            } else if (letra == "-") {
                teclado.img = document.getElementById("tec_-")
            } else if (letra.toLowerCase() == "ç") {
                teclado.img = document.getElementById("tec_cedilha")
            } else {
                teclado.img = document.getElementById("tec_" + letra.toLowerCase());
            }
            canvasContext.drawImage(teclado.img, teclado.x, teclado.y, teclado.w, teclado.h);
            if (especial.check) {
                canvasContext.drawImage(especial.img, especial.x, especial.y, especial.w, especial.h);
            }

            document.getElementById("frase1").innerHTML = palavras[0]._self;
            document.getElementById("frase2").innerHTML = palavra_copia;
            //drawing.text("20px Arial", palavras[0]._self, 10, teclado.h + 100, "white");
            //drawing.text("20px Arial", palavra_copia, 10, teclado.h + 100, "yellow");

        }
    },
    created() {
        document.getElementById("geral").href = "../geral.css";
        document.getElementById("meucss").href = "../bckg/aprender.css";
    }
}

</script>

<style scoped lang="scss">
.menu {
    margin: 0 auto;
    margin-top: 5%;

    span {
        &:hover {
            background-color: #0041e4de;
            box-shadow: 0px 0px 25px rgba(0, 0, 0, 0.4);
        }
    }
}

span {
    all: initial;
    color: white;
    font-family: 'Advent Pro', sans-serif;

    * {
        all: unset;
    }
}

.setasright {
    font-size: 5em !important;
    color: #002a9680;

    &:hover {
        font-size: 8em !important;
        color: white;
        background-color: #0041e4de;
        top: 48vh;
    }
}

.setasleft {
    font-size: 5em !important;
    color: #002a9680;

    &:hover {
        font-size: 8em !important;
        color: white;
        background-color: #0041e4de;
        top: 48vh;
    }
}

dialog::backdrop {
    background-color: rgba(0, 0, 0, 0.5);
}

dialog {
    border: none;
    border-radius: .5rem;
    box-shadow: 0 0 1em rgba(0, 0, 0, 0.3);
    background: linear-gradient(45deg, rgba(77, 201, 230, 0.35) 0%, rgba(33, 12, 174, 0.48) 100%);
}

dialog div:hover {
    cursor: pointer;
}

/******************************************************/
</style>
